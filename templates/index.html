<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linux WebSocket Terminal</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .status {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .terminal {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        
        .terminal-line {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .prompt {
            color: #ffff00;
            font-weight: bold;
        }
        
        .command {
            color: #ffffff;
        }
        
        .output {
            color: #00ff00;
        }
        
        .error {
            color: #ff6b6b;
        }
        
        .directory {
            color: #87ceeb;
        }
        
        h1 {
            text-align: center;
            color: #333;
        }
        
        .command-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .shell-info {
            background: #2d3748;
            color: #a0aec0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üêß Linux WebSocket Terminal</h1>
    
    <div class="status" id="status">
        Connecting to Linux shell...
    </div>
    
    <div class="container">
        <div class="panel">
            <h3>Linux Terminal</h3>
            
            <div class="shell-info" id="shellInfo">
                user@hostname:~$
            </div>
            
            <div class="terminal" id="terminal">
                Welcome to Linux WebSocket Terminal...
                Type any Linux command in the input below.
            </div>
            
            <div class="controls">
                <input type="text" id="commandInput" placeholder="Type Linux command (ls, pwd, cat, grep, etc.)...">
                <button onclick="sendShellCommand()">Execute</button>
            </div>
            
            <div class="command-buttons">
                <button onclick="sendQuickCommand('pwd')">pwd</button>
                <button onclick="sendQuickCommand('ls -la')">ls -la</button>
                <button onclick="sendQuickCommand('whoami')">whoami</button>
                <button onclick="sendQuickCommand('uname -a')">uname -a</button>
                <button onclick="sendQuickCommand('ps aux')">ps aux</button>
                <button onclick="sendQuickCommand('df -h')">df -h</button>
                <button onclick="sendQuickCommand('free -h')">free -h</button>
                <button onclick="sendQuickCommand('cd ~')">cd ~</button>
            </div>
        </div>
        
        <div class="panel">
            <h3>System Info & Tools</h3>
            
            <div class="command-buttons">
                <button onclick="sendCommand('server-status')">üìä Server Status</button>
                <button onclick="sendQuickCommand('cat /etc/os-release')">OS Info</button>
                <button onclick="sendQuickCommand('lscpu')">CPU Info</button>
                <button onclick="sendQuickCommand('lsblk')">Block Devices</button>
                <button onclick="sendQuickCommand('ip addr')">Network</button>
                <button onclick="sendQuickCommand('systemctl status')">Services</button>
                <button onclick="sendQuickCommand('journalctl -n 10')">Logs</button>
                <button onclick="sendQuickCommand('find /home -name \"*.txt\" | head -5')">Find Files</button>
            </div>
            
            <div class="controls">
                <input type="text" id="customCommand" placeholder="Custom system command...">
                <button onclick="sendCustomCommand()">Run Command</button>
            </div>
            
            <div style="margin-top: 15px;">
                <button onclick="clearTerminal()" style="background: #6c757d;">Clear Terminal</button>
                <button onclick="disconnect()" style="background: #dc3545;">Disconnect</button>
                <button onclick="connect()" style="background: #28a745;" id="connectBtn">Reconnect</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        let socket = null;
        let currentUser = 'user';
        let currentHostname = 'hostname';
        let currentDir = '~';
        
        const statusElement = document.getElementById('status');
        const terminalElement = document.getElementById('terminal');
        const shellInfoElement = document.getElementById('shellInfo');
        const connectBtn = document.getElementById('connectBtn');
        const commandInput = document.getElementById('commandInput');

        function connect() {
            if (socket) {
                socket.disconnect();
            }

            updateStatus('Connecting to Linux shell...', 'connecting');
            clearTerminal();
            addToTerminal('üîå Connecting to Linux WebSocket Terminal...');
            
            socket = io('http://localhost:5000', {
                transports: ['websocket', 'polling']
            });

            socket.on('connect', () => {
                updateStatus('Connected to Linux Shell', 'success');
                addToTerminal('‚úÖ Connected to Linux shell');
                connectBtn.disabled = true;
            });

            socket.on('disconnect', (reason) => {
                updateStatus('Disconnected: ' + reason, 'error');
                addToTerminal('‚ùå Disconnected: ' + reason);
                connectBtn.disabled = false;
            });

            socket.on('welcome', (data) => {
                currentUser = data.user;
                currentHostname = data.hostname;
                currentDir = data.current_dir;
                updateShellInfo();
                addToTerminal(`üëã ${data.message}`);
                addToTerminal(`üíª User: ${data.user}@${data.hostname}`);
                addToTerminal(`üìÅ Current directory: ${data.current_dir}`);
                addToTerminal('--- Ready for Linux commands ---');
                showPrompt();
            });

            socket.on('shell-response', (data) => {
                if (data.type === 'cd') {
                    if (data.result.success) {
                        currentDir = data.result.new_dir;
                        updateShellInfo();
                    }
                    addCommandToTerminal(data.command, data.result);
                } else {
                    addCommandToTerminal(data.command, data.result);
                }
                showPrompt();
            });

            socket.on('server-status', (data) => {
                addToTerminal('üìä Server Status: ' + JSON.stringify(data, null, 2));
                showPrompt();
            });

            socket.on('connect_error', (error) => {
                updateStatus('Connection error', 'error');
                addToTerminal('üí• Connection Error: ' + error.message, 'error');
                connectBtn.disabled = false;
            });
        }

        function sendShellCommand() {
            const command = commandInput.value.trim();
            if (command && socket && socket.connected) {
                addToTerminal(`${getPrompt()} ${command}`);
                socket.emit('shell', command);
                commandInput.value = '';
            }
        }

        function sendQuickCommand(command) {
            if (socket && socket.connected) {
                addToTerminal(`${getPrompt()} ${command}`);
                socket.emit('shell', command);
            }
        }

        function sendCommand(command) {
            if (socket && socket.connected) {
                socket.emit('command', command);
            }
        }

        function sendCustomCommand() {
            const command = document.getElementById('customCommand').value.trim();
            if (command) {
                sendQuickCommand(command);
                document.getElementById('customCommand').value = '';
            }
        }

        function addCommandToTerminal(command, result) {
            if (result.success) {
                if (result.output) {
                    addToTerminal(result.output, 'output');
                }
            } else {
                addToTerminal(`Error: ${result.error}`, 'error');
            }
            
            // Show return code if not zero
            if (result.returncode !== 0 && result.returncode !== -1) {
                addToTerminal(`Return code: ${result.returncode}`, 'error');
            }
        }

        function addToTerminal(text, type = 'normal') {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            
            if (type === 'output') {
                line.style.color = '#00ff00';
            } else if (type === 'error') {
                line.style.color = '#ff6b6b';
            } else if (type === 'directory') {
                line.style.color = '#87ceeb';
            }
            
            line.textContent = text;
            terminalElement.appendChild(line);
            terminalElement.scrollTop = terminalElement.scrollHeight;
        }

        function showPrompt() {
            // Prompt is now shown in the shell info bar
        }

        function getPrompt() {
            const dir = currentDir.split('/').pop() || '/';
            return `[${currentUser}@${currentHostname} ${dir}]$`;
        }

        function updateShellInfo() {
            const dir = currentDir.split('/').pop() || '/';
            shellInfoElement.textContent = `${currentUser}@${currentHostname}:${dir}$`;
        }

        function clearTerminal() {
            terminalElement.innerHTML = '';
            addToTerminal('Terminal cleared. Ready for commands.');
            showPrompt();
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                addToTerminal('üîå Manually disconnected');
            }
        }

        function updateStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.style.background = type === 'success' ? '#e8f5e8' : 
                                           type === 'error' ? '#f8d7da' : 
                                           type === 'connecting' ? '#fff3cd' : '#e2e3e5';
        }

        // Auto-connect when page loads
        document.addEventListener('DOMContentLoaded', connect);

        // Enable sending with Enter key
        commandInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendShellCommand();
        });

        document.getElementById('customCommand').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendCustomCommand();
        });

        // Focus on command input
        commandInput.focus();

        // Expose for console testing
        window.sendShellCommand = sendShellCommand;
        window.socket = socket;
    </script>
</body>
</html>